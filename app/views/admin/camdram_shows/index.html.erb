<% content_for :title, 'Configure Shows' %>
<% content_for :heading, 'Configure Shows' %>

<p>
  Here you can import shows from Camdram that aren't yet known to the internals of Room Booking.
  Once they're imported you can activate and deactivate them, as well as set limits on the total booking hours they're allowed per week.
  You can choose to either import a batch of upcoming shows all at once, or manually import a specific show using the interface below.
  Shows are populated based on upcoming shows as defined by Camdram. If the show you're after isn't listed, you can manually import it by URL.
  Starting a new term will preserve old shows and their bookings for historic record, but otherwise disable them from the system.
</p>

<%= render 'import_tools' %>

<table class="table table-condensed table-bordered table-hover">
  <thead>
    <%= content_tag :tr do %>
      <%= content_tag(:td, 'Show Name') %>
      <%= content_tag(:td, 'Status') %>
      <%= content_tag(:td, 'Booking Hours per Week') %>
    <% end %>
  </thead>
  <tbody>
    <% @camdram_shows.each do |camdram_show| %>
      <% roombooking_show = CamdramShow.find_from_camdram(camdram_show) %>
      <% next if roombooking_show.try(:dormant?) %>
      <%= content_tag :tr do %>
        <%= content_tag(:td, camdram_show.name) %>
        <%= content_tag(:td, (actions_for_show camdram_show, roombooking_show)) %>
        <%= content_tag :td do %>
          <%= form_with model: roombooking_show, url: admin_camdram_show_path(roombooking_show) do |form| %>
            <%= form.label :max_rehearsals, 'Rehearsals:' %>
            <%= form.number_field :max_rehearsals, min: 0, step: 1, class: 'form-control mb-2', disabled: !roombooking_show.active?, onchange: 'Rails.fire(this.form, "submit")' %>
            <%= form.label :max_auditions, 'Auditions:' %>
            <%= form.number_field :max_auditions, min: 0, step: 1, class: 'form-control mb-2', disabled: !roombooking_show.active?, onchange: 'Rails.fire(this.form, "submit")' %>
            <%= form.label :max_meetings, 'Meetings:' %>
            <%= form.number_field :max_meetings, min: 0, step: 1, class: 'form-control mb-2', disabled: !roombooking_show.active?, onchange: 'Rails.fire(this.form, "submit")' %>
          <% end if roombooking_show.present? %>
        <% end %>
      <% end %>
    <% end %>
  </tbody>
</table>

<%= paginate @camdram_shows %>

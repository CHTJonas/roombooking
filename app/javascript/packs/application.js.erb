import $ from "jquery";
import * as Sentry from '@sentry/browser';
import {install} from '@github/hotkey'

require("@rails/ujs").start()
require("@rails/activestorage").start()
require("channels")

window.rbModal = (title, message) => {
    $('#roombookingModalTitle').text(title);
    $('#roombookingModalContent').text(message);
    $('#roombookingModal').modal('show');
};
  
window.rbAjaxFail = () => {
    rbModal("AJAX Error", "Oops something's gone wrong! Please try again after a few seconds and contact support if you continue experiencing issues.");
};
  
$(() => {
    window['$'] = $;
    var el, i, len, ref;
    Sentry.init({
      dsn: '<%= ENV['SENTRY_DSN'] %>',
      release: '<%= Roombooking::Version %>',
      environment: '<%= Rails.env %>'
    });
    Sentry.configureScope((scope) => {
        var dataset, id, node, user;
        node = $("#rb-user-gravatar-link")[0];
        if (node) {
            dataset = node.dataset;
            id = Number(dataset.userId);
            user = { id: id };
            scope.setUser(user);
        }
    });
    $("a").on("ajax:error", rbAjaxFail);
    $("form").on("ajax:error", rbAjaxFail);
    ref = document.querySelectorAll('[data-hotkey]');
    for (i = 0, len = ref.length; i < len; i++) {
      el = ref[i];
      install(el);
    }
  });
  